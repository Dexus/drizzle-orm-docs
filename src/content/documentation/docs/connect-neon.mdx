import Tab from '@components/markdown/Tab.astro';
import Tabs from '@components/markdown/Tabs.astro';
import Npm from "@components/markdown/Npm.astro";
import Callout from '@components/markdown/Callout.astro';
import Steps from '@components/markdown/Steps.astro';
import AnchorCards from '@components/markdown/AnchorCards.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from "@mdx/CodeTabs.astro"
import Section from "@mdx/Section.astro"
import WhatsNextPostgres from "@mdx/WhatsNextPostgres.astro"

# Drizzle \<\> Neon Postgres
<Prerequisites>
- Database [connection basics](/docs/connect-overview) with Drizzle
- Neon serverless database - [website](https://neon.tech)
- Neon serverless driver - [docs](https://neon.tech/docs/serverless/serverless-driver) & [github](https://github.com/neondatabase/serverless)
- Drizzle postgresql drivers - [docs](/docs/get-started-postgresql)
</Prerequisites>

Drizzle has native support for Neon connection with `neon-http` and `neon-websockets` drivers, they use **neon-serverless** driver under the hood.  
  
With the `neon-http` and `neon-websockets` drivers you can access a Neon database from serverless environments over HTTP or WebSockets instead of TCP.  
Querying over HTTP is faster for single, non-interactive transactions.  
  
If you need session, interactive transaction support or a fully-compatible drop-in replacement for the `pg` driver - you can use websockets based `neon-serverless` driver.
You connect to Neon database directly using either [postgres](/docs/get-started-postgresql#postgresjs) or [node-postgres](/docs/get-started-postgresql/#node-postgres)
  
For an example of using Drizzle ORM with the Neon Serverless driver in a Cloudflare Worker, **[see here.](http://driz.link/neon-cf-ex)**
To use Neon from a serverfull environment, you can use the PostgresJS driver, as described in Neon's **[official nodejs docs](https://neon.tech/docs/guides/node)** — see **[docs](#postgresjs)**.

#### Step 1 - Install packages
<Npm>
drizzle-orm @neondatabase/serverless
-D drizzle-kit
</Npm>

#### Step 2 - initialise driver and make a query
<CodeTabs items={["Neon HTTP", "Neon Websockets", "node-postgres" , "postgres.js"]}>
```typescript
import { drizzle } from 'drizzle-orm';

const db = await drizzle("neon-http", process.env.DATABASE_URL);

const result = await db.execute('select 1');
```
<Section>
```typescript
import { drizzle } from 'drizzle-orm';

const db = await drizzle("neon-websockets", process.env.DATABASE_URL);

const result = await db.execute('select 1');
```
```typescript
// For NodeJS - make sure to install 'ws' and 'bufferutil' packages
import { drizzle } from 'drizzle-orm';
import ws from 'ws';

const db = await drizzle("neon-websockets", {
  connection: process.env.DATABASE_URL,
  ws: ws,
});

const result = await db.execute('select 1');
```
<Callout type="warning" emoji="⚙️">
Additional configuration is required to use WebSockets in environments where the `WebSocket` global is not defined, such as Node.js.  
Add the `ws` and `bufferutil` packages to your project's dependencies, and set the `ws` to Drizzle config.
</Callout>
</Section>
```typescript
// make sure to install 'pg' package
import { drizzle } from 'drizzle-orm';

const db = await drizzle("node-postgres", process.env.DATABASE_URL);
const result = await db.execute('select 1');
```
```typescript
// make sure to install 'postgres' package
import { drizzle } from 'drizzle-orm';

const db = await drizzle("postgres-js", process.env.DATABASE_URL);
const result = await db.execute('select 1');
```
</CodeTabs>

#### What's next?
<WhatsNextPostgres/>
